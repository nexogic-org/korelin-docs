# Korelin 异常与异常处理规范 (Exception Handling Specification)

## 1. 异常体系概述 (Overview)
Korelin 语言建立了一套完整的**异常体系**（Exception System），旨在为开发者提供清晰、可预测的错误处理机制。该体系覆盖了两个主要阶段的错误：
1.  **编译阶段**（Compilation Phase）：主要检测**语法错误**（Syntax Error），如拼写错误、符号缺失等。此类错误会导致编译失败，程序无法启动，必须在运行前修正。
2.  **运行阶段**（Runtime Phase）：主要处理**运行时异常**（Runtime Exception），如除零、空指针引用等。此类错误在程序执行过程中发生，可以通过代码捕获并处理。

通过标准化的异常分类和结构化的错误处理语法，Korelin 能够帮助开发者快速定位问题根源，并在运行时优雅地处理意外情况，从而提升程序的**健壮性**（Robustness）与**可靠性**（Reliability）。

## 2. 核心异常类型定义 (Core Exception Definitions)
Korelin 的异常类型设计遵循“见名知意”的原则。下表列出了语言内核定义的所有标准异常类型，涵盖了绝大多数编程场景。

> **说明**：Korelin 语言对缩进不敏感、代码块使用花括号 `{}` 包裹。表格中包含英文异常名称及其对应的中文描述，便于开发者对照查阅。

### 2.1 异常类型对照表 (Exception Type Table)
| 异常名称（英文）| 错误描述（中文）|
|--------------------|------------------------------|
| `NameDefineError` | **名称定义错误**。使用了未声明、未定义的变量、函数、类或其他标识符，**解释器**（Interpreter）/ **编译器**（Compiler）无法找到其对应的定义信息。 |
| `BracketNotClosedError` | **括号未闭合错误**。各类成对符号（圆括号 `()`、方括号 `[]`、花括号 `{}`、引号 `''/""`）缺少对应的闭合符号，导致代码结构不完整。（通常为语法错误） |
| `MissingSemicolonError` | **分号缺失错误**。语句末尾遗漏必需的分号 `;`，无法正确分割语句边界，导致解释器无法识别单个完整语句。（通常为语法错误） |
| `DivisionByZeroError` | **除零错误**。进行除法运算或取模运算时，除数（分母）的值为 0，违反数学运算规则。 |
| `UnknownCharacterError` | **未知字符错误**。代码中包含 Korelin 语言不支持、无法识别的字符（如全角符号、非法控制字符等）。 |
| `MissingKeywordOrSymbolError` | **关键字或符号缺失错误**。遗漏 Korelin 语言必需的关键字、**操作符**（Operator）或分隔符（如 `if` 后的圆括号、函数定义的关键字等）。 |
| `IllegalArgumentError` | **非法参数错误**。调用函数/方法时，传入的参数不符合要求（如类型不兼容、数值越界、参数数量不匹配等）。 |
| `IndexOutOfBoundsError` | **索引越界错误**。访问数组、列表等有序集合时，使用的**索引**（Index）值超出了合法范围（小于 0 或大于等于集合长度）。 |
| `NilReferenceError` | **空引用错误**。试图访问一个未初始化、值为 `nil` 的对象或引用的属性、方法。 |
| `TypeMismatchError` | **类型不匹配错误**。数据类型不兼容导致的错误（如将字符串赋值给数值变量、对不支持的类型执行特定运算）。 |
| `FileNotFoundError` | **文件未找到错误**。试图读取、写入或操作不存在的文件/目录，或因路径错误、权限不足导致无法访问。 |
| `KeywordAsIdentifierError` | **关键字作标识符错误**。尝试使用 Korelin 语言的保留关键字（如 `if`, `var`, `class` 等）作为变量名、函数名或其他标识符。 |
| `InvalidTypePositionError` | **无效的类型位置错误**。在声明变量时，类型说明符的位置不正确（例如使用了旧语法的 `var x int` 而非 `var int x`）。 |
| `IllegalSyntaxError` | **非法语法错误**。违反 Korelin 语言基础语法规范，且不属于上述特定细分类型的通用语法违规。 |

## 3. 异常处理机制 (Exception Handling Mechanism)
Korelin 采用经典的 `try-catch` 结构来处理**运行时异常**（Runtime Exception）。

**重要提示**：
`try-catch` 机制**无法**捕获**语法错误**（Syntax Error）。语法错误（如 `BracketNotClosedError`、`MissingSemicolonError` 等）属于**编译时**（Compile-time）问题，解释器在解析代码结构时就会直接报错并终止，程序根本不会开始执行，因此无法进入 `try` 块。`try-catch` 仅用于捕获程序逻辑正确但在执行过程中发生的意外情况（如文件不存在、网络中断、计算溢出等）。

### 3.1 异常捕获结构 (Exception Handling Structure)
使用 `try` 块包裹可能抛出异常的代码，使用一个或多个 `catch` 块来捕获并处理特定类型的异常。

#### 语法规范 (Syntax Specification)
```korelin
try {
    // 监控代码块 (Guarded Block)：此处放置可能会抛出异常的业务逻辑
    // 一旦发生运行时异常，后续代码将跳过，直接进入对应的 catch 块
} catch (错误类型1) {
    // 异常处理块1 (Handler Block)：仅当捕获到 [错误类型1] 时执行
    // 可在此处进行日志记录、错误恢复或用户提示
} catch (错误类型2) {
    // 异常处理块2：仅当捕获到 [错误类型2] 时执行
} 
// 程序继续执行...
```

#### 关键规则 (Key Rules)
1.  **精确匹配**（Exact Match）：`catch` 块中的错误类型必须与实际抛出的异常类型一致（或为其父类型）才能成功捕获。
2.  **顺序执行**（Sequential Execution）：如果有多个 `catch` 块，解释器会自上而下依次匹配，执行第一个匹配成功的块，其余忽略。
3.  **作用域隔离**（Scope Isolation）：`try` 块中定义的局部变量在 `catch` 块中不可见（除非在外部定义）。

### 3.2 典型示例 (Typical Examples)
以下示例展示了如何处理文件读取和数学运算中可能出现的运行时异常。

```korelin
// 示例：文件读取与运算的安全处理
try {
    // 尝试打开一个配置文件
    var config = openFile("config.ini")
    
    // 可能会触发除零错误的操作
    var count = 0
    var result = 100 / count 
    
} catch (FileNotFoundError) {
    // 处理文件不存在的情况
    print("错误：配置文件未找到，将使用默认设置。")
    
} catch (DivisionByZeroError) {
    // 处理除数为零的情况
    print("错误：计算过程中出现除零操作，结果重置为 0。")
    
} catch (NilReferenceError) {
    // 处理可能的空指针引用
    print("错误：尝试访问空对象。")
}
```

## 4. 典型异常场景与示例 (Typical Scenarios)
为了帮助开发者更好地理解异常的触发条件，以下列举了几种常见运行时异常的错误代码示例。

### 4.1 数学运算异常 (DivisionByZeroError)
当除数为 0 时触发。

```korelin
var a = 10
var b = 0
// 触发 DivisionByZeroError
var c = a / b 
```

### 4.2 空值引用异常 (NilReferenceError)
当试图操作 `nil` 值时触发。

```korelin
// 定义一个未初始化的变量，默认为 nil
var string name
// 触发 NilReferenceError，因为 name 为 nil，无法进行字符串操作或属性访问
print(name.length) 
```

### 4.3 索引越界异常 (IndexOutOfBoundsError)
当访问数组不存在的索引时触发。

```korelin
// 假设 arr 是一个长度为 3 的数组 [1, 2, 3]
var arr = [1, 2, 3]
// 触发 IndexOutOfBoundsError，因为最大索引为 2
var val = arr[5] 
```

### 4.4 类型不匹配异常 (TypeMismatchError)
当数据类型不符合预期时触发。

```korelin
var int age = 20
// 触发 TypeMismatchError，不能将字符串赋值给 int 类型变量
age = "twenty" 
```
